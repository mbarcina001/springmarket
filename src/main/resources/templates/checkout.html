<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	<head>
		<th:block th:include="fragments/head :: head"></th:block>
		<th:block th:include="fragments/header :: header_styles"></th:block>
		<th:block th:include="fragments/footer :: footer_styles"></th:block>
		<th:block th:include="fragments/checkout_product_rows :: checkout_product_rows_styles"></th:block>
		<th:block th:include="fragments/address_list :: address_list_styles"></th:block>
		<th:block th:include="fragments/credit_card_list :: credit_card_list_styles"></th:block>
	</head>
	
	<body>
		<th:block th:include="fragments/header :: header"></th:block>
	
		<main class="wrap">
		
			<th:block th:include="fragments/checkout_product_rows :: checkout_product_rows"></th:block>
			<th:block th:include="fragments/address_list :: address_list"></th:block>
			<th:block th:include="fragments/credit_card_list :: credit_card_list"></th:block>
			<th:block th:include="fragments/delivery_method_list :: delivery_method_list"></th:block>	
			
			<form id="confirmDeliveryForm" action="#" th:action="@{confirmDelivery}" method="POST">
				<input id="selectedAddressId" th:name="selectedAddressId" type="hidden" />
				<input id="selectedCreditCardId" th:name="selectedCreditCardId" type="hidden" />
				<input id="selectedDeliveryMethodId" th:name="selectedDeliveryMethodId" type="hidden" />
			</form>		
		
			<div class="text-right mt-4">
				<button id="backBtn" class="btn btn-secondary" onclick="window.location.href = '/products/'">Go back</button>
				<button id="confirmBtn" class="btn btn-success" >Confirm</button>
			</div>
		</main>
	
		<th:block th:include="fragments/footer :: footer"></th:block>
		<th:block th:include="fragments/scripts :: scripts"></th:block>
	
		<script>
			$(document).ready(function () {
				$(".address").click(function(){
					$(".address.selected").removeClass("selected");
					$(this).addClass("selected");
					$("#confirmDeliveryForm #selectedAddressId").val($(this).attr("id"));
				});
			
				$(".account").click(function(){
					$(".account.selected").removeClass("selected");
					$(this).addClass("selected");
					$("#confirmDeliveryForm #selectedCreditCardId").val($(this).attr("id"));
				});
				
				$(".deliveryMethod").click(function(){
					$("#confirmDeliveryForm #selectedDeliveryMethodId").val($(this).attr("id"));					
				});
				
				$("#confirmBtn").click(function(){
					if($("#confirmDeliveryForm #selectedAddressId").val() != "" && 
					$("#confirmDeliveryForm #selectedCreditCardId").val() != "" && 
					$("#confirmDeliveryForm #selectedDeliveryMethodId").val() != ""){
						$("#confirmDeliveryForm").submit();
					}else{
						// TODO: Add error toast
						console.log("ERROR");
					}
				});
			});
		</script>
	</body>
</html>