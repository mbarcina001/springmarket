<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	<head>
		<th:block th:include="fragments/head :: head"></th:block>
		<th:block th:include="fragments/header :: header_styles"></th:block>
		<th:block th:include="fragments/footer :: footer_styles"></th:block>
		<th:block th:include="fragments/product_cols :: product_cols_styles"></th:block>
		<th:block th:include="fragments/product_rows :: product_rows_styles"></th:block>
	</head>
	
	<body>	
		<th:block th:include="fragments/header :: header"></th:block>
		
		<main class="wrap">
		
			<form id="productsInCartForm">
				<input id="deliveryId" th:name="deliveryId" type="hidden" />
			</form>
			
			<div class="see-full-list" th:if="${showingSearchResult}">
				<a href="/products/" th:if="showingSearchResult">See full product list</a>
			</div>
			
			<div class="no-results" th:if="${products.size() == 0}">
				<p>No results found</p>
			</div>
			
			<form id="pagination-form" action="#" th:action="@{/products/}" method="POST">
				<input type="hidden" id="total-products-input" th:value="${totalProducts}"/>
				<input type="hidden" id="actual-page-input" th:value="${actualPage}"/>
				<input type="hidden" id="next-page-input" th:name="nextPage"/>
				<input type="hidden" id="search-term-input" th:name="searchTerm" th:value="${searchTerm}"/>
				<input type="hidden" id="items-per-page-input" th:name="itemsPerPage" th:value="${itemsPerPage}"/>
			</form>
			
			<th:block th:include="fragments/product_cols :: product_cols"></th:block>
			<th:block th:include="fragments/product_rows :: product_rows"></th:block>
			
			<nav aria-label="Page navigation">
				<ul class="pagination justify-content-end">
					<li class="page-item first disabled">
						<a class="page-link" href="javascript:paginationFirst();" tabindex="-1">First</a>
					</li>
					<li class="page-item previous disabled">
						<a class="page-link" href="javascript:paginationPrevious();" aria-label="Previous">
							<span aria-hidden="true"><i class="fas fa-chevron-left"></i></span>
							<span class="sr-only">Previous</span>
						</a>
					</li>
					<li class="page-item active page">
						<a class="page-link" href="javascript:paginationPage(0);">1</a>
					</li>
					<li class="page-item page">
						<a class="page-link" href="javascript:paginationPage(1);">2</a>
					</li>
					<li class="page-item page">
						<a class="page-link" href="javascript:paginationPage(2);">3</a>
					</li>
					<li class="page-item next">
						<a class="page-link" href="javascript:paginationNext();" aria-label="Next">
							<span aria-hidden="true"><i class="fas fa-chevron-right"></i></span>
							<span class="sr-only">Next</span>
						</a>
					</li>
					<li class="page-item last">
						<a class="page-link" href="javascript:paginationLast();">Last</a>
					</li>
				</ul>
			</nav>
		
			<div class="page-buttons text-right">
				<button class="btn btn-success" onclick="createDelivery('/delivery/checkout')">Proceed to checkout</button>
			</div>
			
		</main>
		
		<th:block th:include="fragments/footer :: footer"></th:block>
		<th:block th:include="fragments/scripts :: scripts"></th:block>
	
		<script>			
			$(document).ready(function () {
				displayProductsSizeAccordingly();
				loadProductsFromCart();
				actualPage = parseInt($("#actual-page").val()) || 1;
				itemsPerPage = parseInt($("#items-per-page").val()) || 12;
				totalPages = parseInt(Math.ceil($("#total-products").val() / itemsPerPage));
				renderPagination();
			});

			
			$( window ).resize(function() {
				displayProductsSizeAccordingly();
			});
			
			function displayProductsSizeAccordingly(){				
				if($( window ).width()>600){
					if($("#product-list-cols").hasClass("hidden")){
						$("#product-list-cols").removeClass("hidden");
					}
					
					if(!$("#product-list-rows").hasClass("hidden")){
						$("#product-list-rows").addClass("hidden");
					}
				}else{
					if(!$("#product-list-cols").hasClass("hidden")){
						$("#product-list-cols").addClass("hidden");
					}
					
					if($("#product-list-rows").hasClass("hidden")){
						$("#product-list-rows").removeClass("hidden");
					}
				}
			}
		</script>
	</body>
</html>